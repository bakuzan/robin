<div class="page">
  <form
    class="form"
    [formGroup]="seriesForm"
    (ngSubmit)="onSubmit()"
    novalidate
    autocomplete="off"
  >
    <div class="
    button-group
    button-group--right">
      <app-nav-link [to]="cancelUrl">Cancel</app-nav-link>
      <app-rbn-button
        type="submit"
        [theme]="primary"
      >Save</app-rbn-button>
    </div>
    <div class="form__content">
      <app-input-box
        type="hidden"
        name="id"
        formControlName="id"
      ></app-input-box>
      <app-input-box
        class="form__input"
        label="Name"
        name="name"
        formControlName="name"
        [required]="true"
      ></app-input-box>
      <app-select-box
        class="form__input"
        label="Type"
        name="type"
        formControlName="type"
        [options]="types"
        [required]="true"
      ></app-select-box>
      <app-input-box
        class="form__input"
        type="number"
        label="Ending Volume"
        name="volumeCount"
        formControlName="volumeCount"
        min="0"
      ></app-input-box>

      <div class="sub-content">
        <div class="sub-content__header">
          <h4 class="sub-content__title">Volume list</h4>
          <app-rbn-button
            [theme]="secondary"
            (click)="onAddVolume($event)"
          >
            Add
          </app-rbn-button>
        </div>
        <app-list
          columns="one"
          [isAsync]="false"
          [items]="volumes.controls"
          formArrayName="volumes"
        >
          <ng-template
            let-item="item"
            let-i="index"
          >
            <div
              class="form__array-item-wrapper"
              [formGroupName]="i"
            >
              <app-input-box
                type="hidden"
                name="{{i}}.id"
                formControlName="id"
              ></app-input-box>
              <app-input-box
                class="form__input"
                type="number"
                label="Number"
                name="{{i}}.number"
                formControlName="number"
                min="1"
                [required]="true"
              ></app-input-box>

              <app-input-box
                class="form__input"
                type="date"
                label="Released"
                name="{{i}}.releaseDate"
                formControlName="releaseDate"
              ></app-input-box>
              <app-input-box
                class="form__input"
                type="date"
                label="Bought"
                name="{{i}}.boughtDate"
                formControlName="boughtDate"
              ></app-input-box>

              <app-input-box
                class="form__input"
                type="number"
                label="RRP"
                name="{{i}}.rrp"
                formControlName="rrp"
                min="0"
              ></app-input-box>
              <app-input-box
                class="form__input"
                type="number"
                label="Paid"
                name="{{i}}.paid"
                formControlName="paid"
                min="0"
              ></app-input-box>

              <!-- 
                TODO
                Make autocomplete/chip list
               -->
              <app-input-box
                type="hidden"
                name="{{i}}.retailerId"
                formControlName="retailerId"
              ></app-input-box>

              <app-tickbox
                class="form__input"
                label="Used Discount Code"
                name="{{i}}.usedDiscountCode"
                formControlName="usedDiscountCode"
              >Used Discount Code</app-tickbox>
              <app-rbn-button
                title="Save Volume"
                [icon]="saveIcon"
                (click)="onSaveVolume(i)"
              ></app-rbn-button>
              <app-rbn-button
                title="Remove Volume"
                [icon]="crossIcon"
                (click)="onRemoveVolume(i)"
              ></app-rbn-button>
            </div>
          </ng-template>
        </app-list>
      </div>
    </div>
  </form>
</div>