<div class="page">
  <form
    class="form"
    [formGroup]="seriesForm"
    (ngSubmit)="onSubmit()"
    novalidate
    autocomplete="off"
  >
    <div class="
    button-group
    button-group--right">
      <app-nav-link [to]="cancelUrl">Cancel</app-nav-link>
      <app-rbn-button
        type="submit"
        [theme]="primary"
      >Save</app-rbn-button>
    </div>
    <div class="form__content">
      <app-input-box
        type="hidden"
        name="id"
        formControlName="id"
      ></app-input-box>
      <app-input-box
        class="form__input"
        label="Name"
        name="name"
        formControlName="name"
        [required]="true"
      ></app-input-box>
      <app-select-box
        class="form__input"
        label="Type"
        name="type"
        formControlName="type"
        [options]="types"
        [required]="true"
      ></app-select-box>
      <app-input-box
        class="form__input"
        type="number"
        label="Ending Volume"
        name="volumeCount"
        formControlName="volumeCount"
        min="0"
      ></app-input-box>

      <app-tabs>
        <app-tab name="volumes">
          <div class="sub-content">
            <div class="sub-content__header">
              <app-rbn-button
                [theme]="secondary"
                (click)="onAddVolume($event)"
              >
                Add
              </app-rbn-button>
            </div>
            <app-list
              columns="one"
              [isAsync]="false"
              [items]="volumes.controls"
              formArrayName="volumes"
            >
              <ng-template
                let-item="item"
                let-i="index"
              >
                <div
                  class="form__array-item-wrapper"
                  [formGroupName]="i"
                >
                  <app-input-box
                    type="hidden"
                    name="{{i}}.id"
                    formControlName="id"
                  ></app-input-box>
                  <app-input-box
                    class="form__input form__input--integer"
                    type="number"
                    label="Number"
                    name="{{i}}.number"
                    formControlName="number"
                    min="1"
                    [required]="true"
                  ></app-input-box>

                  <app-input-box
                    class="form__input form__input--date"
                    type="date"
                    label="Released"
                    name="{{i}}.releaseDate"
                    formControlName="releaseDate"
                  ></app-input-box>
                  <app-input-box
                    class="form__input form__input--date"
                    type="date"
                    label="Bought"
                    name="{{i}}.boughtDate"
                    formControlName="boughtDate"
                  ></app-input-box>

                  <app-input-box
                    class="form__input form__input--float"
                    type="number"
                    label="RRP"
                    name="{{i}}.rrp"
                    formControlName="rrp"
                    min="0"
                    step="0.01"
                  ></app-input-box>
                  <app-input-box
                    class="form__input form__input--float"
                    type="number"
                    label="Paid"
                    name="{{i}}.paid"
                    formControlName="paid"
                    min="0"
                    step="0.01"
                  ></app-input-box>

                  <app-autocomplete
                    label="Retailer"
                    name="{{i}}.retailer"
                    formControlName="retailer"
                    [options]="retailers"
                  ></app-autocomplete>

                  <app-tickbox
                    class="form__input"
                    label="Used Discount Code"
                    name="{{i}}.usedDiscountCode"
                    formControlName="usedDiscountCode"
                  >Used Discount Code</app-tickbox>

                  <div class="button-group button-group--stacked">
                    <app-rbn-button
                      *ngIf="!data.isCreate && item.value"
                      title="Save Volume"
                      [icon]="saveIcon"
                      (click)="onSaveVolume(i)"
                      [disabled]="item.pristine"
                    ></app-rbn-button>
                    <app-rbn-button
                      title="Remove Volume"
                      [icon]="crossIcon"
                      (click)="onRemoveVolume(i)"
                    ></app-rbn-button>
                  </div>
                </div>
              </ng-template>
            </app-list>
          </div>
        </app-tab>
        <app-tab name="statistics">
          <div class="sub-content">
            <div class="sub-content__header">
            </div>
            <div class="statistic-widget">
              <table class="table">
                <tbody>
                  <tr
                    *ngFor="let stat of statistics"
                    class="table__row statistic"
                  >
                    <th class="statistic__label">{{stat.label}}</th>
                    <td class="statistic__value">{{stat.value}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </app-tab>
      </app-tabs>
    </div>
  </form>
</div>